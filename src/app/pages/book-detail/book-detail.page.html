<app-header title="Detalle" [showBackButton]="true"></app-header>

<ion-content>
  <section class="book-detail__intro">
    <p class="book-detail__eyebrow">Ficha del libro</p>
    <h1 class="book-detail__intro-title">{{ book?.title ?? 'Detalle del libro' }}</h1>
    <p class="book-detail__intro-subtitle">
      Revisa la informacion principal del libro y, si quieres, agregalo a una lista.
    </p>
  </section>

  @if (loading) {
    <div class="book-detail__spinner">
      <ion-spinner name="crescent" />
    </div>
  } @if (!loading && error) {
    <app-empty-state type="error" message="No se pudo cargar el libro." />
  } @if (!loading && book) {
    <article class="book-detail__card">
      <div class="book-detail__cover">
        @if (coverUrl && !imageError) { @if (!imageLoaded) {
          <ion-skeleton-text animated class="book-detail__skeleton" />
        }
          <img
            [src]="coverUrl"
            [alt]="book.title"
            class="book-detail__img"
            [class.book-detail__img--hidden]="!imageLoaded"
            (load)="onImageLoad()"
            (error)="onImageError()"
          />
        } @else {
          <div class="book-detail__placeholder">Sin portada</div>
        }
      </div>

      <div class="book-detail__body">
        <h2 class="book-detail__title">{{ book.title }}</h2>
        <p class="book-detail__authors">{{ authorsLabel }}</p>

        @if (book.first_publish_year) {
          <p class="book-detail__year">Publicado en {{ book.first_publish_year }}</p>
        }

        <p class="book-detail__description">
          {{ book.description ?? 'Sin descripcion disponible.' }}
        </p>

        @if (!fromList) {
          <ion-button expand="block" class="book-detail__action" (click)="addToList()">
            <ion-icon slot="start" name="bookmark-outline" />
            Agregar a lista
          </ion-button>
        }
      </div>
    </article>
  }
</ion-content>
